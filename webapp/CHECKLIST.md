# Чеклист: почему мини-приложение показывает ошибку

## BotFather — ничего делать не нужно
Кнопка «Мини-приложение» берёт URL из кода бота (переменная `WEBAPP_URL` в Railway). В BotFather настраивать Web App URL не нужно.

---

## Где какие переменные

| Переменная    | Где задать | Зачем |
|---------------|------------|--------|
| `WEBAPP_URL`  | **Railway** | URL мини-приложения на Vercel, чтобы в боте была кнопка с правильной ссылкой. |
| `BOT_API_URL` | **Vercel**  | URL бота на Railway (например `https://nogtegrizzly-production.up.railway.app`), чтобы прокси знал, куда слать запросы. |

Если `BOT_API_URL` в Vercel не задан, в коде прокси уже есть запасной URL; тогда переменная не обязательна.

---

## Что проверить в Vercel

1. **Root Directory**  
   В настройках проекта должен быть указан каталог **`webapp`** (или тот, где лежат `index.html` и папка `api/`).  
   Иначе маршруты `/api/user` и `/api/events` могут не находиться.

2. **Деплой**  
   После смены Root Directory или кода нужен новый деплой.

3. **Проверка прокси в браузере**  
   Откройте в браузере (не в Telegram):
   - ваш домен Vercel, например: `https://ваш-проект.vercel.app/`  
   Откройте DevTools (F12) → вкладка Network, обновите страницу и посмотрите, есть ли запросы к `/api/user` и с каким статусом (200, 404, 500 и т.д.).

---

## Что покажет мини-приложение после правок

В коде включён вывод **реальной** ошибки в алерт.  
При следующей попытке загрузки вы увидите одно из сообщений:

- **«initData не доступен»** — мини-приложение открыто не из Telegram (например, по прямой ссылке в браузере). Нужно открывать только кнопкой в боте.
- **«Invalid auth»** или **«No initData»** — запрос доходит до бота, но авторизация не прошла (проверка подписи initData).
- **«User not found»** — пользователь не найден в БД (нужен хотя бы один `/start` в боте).
- **«Код 404»** — по пути `/api/user` ничего не отвечает: проверьте Root Directory в Vercel и что деплой из папки с `api/user.js` и `api/events.js`.
- **«Failed to fetch»** / сетевая ошибка — запрос до Vercel не доходит (сеть, блокировка, неверный домен).

По тексту ошибки в алерте можно понять, на каком этапе ломается цепочка (браузер → Vercel → Railway).
